From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: RootCubed <liam@rootcubed.dev>
Date: Tue, 20 Dec 2022 14:39:56 +0100
Subject: [PATCH] 4664: PowerPC: Fix implementation of fsel[.] instruction

Fix implementation of fsel instruction
---
 .../PowerPC/data/languages/ppc_instructions.sinc           | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc b/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
index a3fa7a8f7..296ba6507 100644
--- a/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
+++ b/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
@@ -1918,7 +1918,7 @@
 	local tmpfB = fB;
 	zero:4=0;
 	fD=fC;
-	if (tmpfA f> int2float(zero)) goto inst_next;
+	if (tmpfA f>= int2float(zero)) goto inst_next;
 	fD=tmpfB;
 }
 
@@ -1929,9 +1929,10 @@
 	local tmpfB = fB;
 	zero:4=0;
 	fD=fC;
-	cr1flags();
-	if (tmpfA f> int2float(zero)) goto inst_next;
+	if (tmpfA f>= int2float(zero)) goto <end>;
 	fD=tmpfB;
+<end>
+	cr1flags();
 }
 
 #fsqrt f0r,fr0	0xfc 00 00 2c
-- 
2.39.0

