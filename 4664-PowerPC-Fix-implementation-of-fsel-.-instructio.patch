From ffd3f0a3d89459bfe539bada12ebe55432434590 Mon Sep 17 00:00:00 2001
From: RootCubed <liam@rootcubed.dev>
Date: Sat, 15 Oct 2022 23:19:30 +0200
Subject: [PATCH] 4664: PowerPC: Fix implementation of fsel[.] instruction

Fix implementation of fsel instruction
---
 .../Processors/PowerPC/data/languages/ppc_instructions.sinc  | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc b/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
index a3fa7a8f7..6079c3c96 100644
--- a/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
+++ b/Ghidra/Processors/PowerPC/data/languages/ppc_instructions.sinc
@@ -1918,7 +1918,7 @@
 	local tmpfB = fB;
 	zero:4=0;
 	fD=fC;
-	if (tmpfA f> int2float(zero)) goto inst_next;
+	if (tmpfA f>= int2float(zero)) goto inst_next;
 	fD=tmpfB;
 }
 
@@ -1930,8 +1930,9 @@
 	zero:4=0;
 	fD=fC;
 	cr1flags();
-	if (tmpfA f> int2float(zero)) goto inst_next;
+	if (tmpfA f>= int2float(zero)) goto inst_next;
 	fD=tmpfB;
+	cr1flags();
 }
 
 #fsqrt f0r,fr0	0xfc 00 00 2c
-- 
2.38.1

