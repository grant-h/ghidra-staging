From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Wiz <95232096+GameCubeGBA@users.noreply.github.com>
Date: Sun, 25 Jun 2023 12:51:59 -0400
Subject: [PATCH] 5492: Prefer getComponentContaining over getComponentAt where
 applicible

This should make the code more understandable.
---
 .../app/cmd/data/CreateDataInStructureBackgroundCmd.java      | 2 +-
 .../app/plugin/core/analysis/ObjectiveC1_MessageAnalyzer.java | 2 +-
 .../ghidra/app/util/bin/format/pe/ResourceDataDirectory.java  | 2 +-
 .../app/util/viewer/listingpanel/ProgramBigListingModel.java  | 4 ++--
 .../core/codebrowser/ExpandCollapseDataActionsTest.java       | 2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/data/CreateDataInStructureBackgroundCmd.java b/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/data/CreateDataInStructureBackgroundCmd.java
index 23a1a9be2..31285d923 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/data/CreateDataInStructureBackgroundCmd.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/cmd/data/CreateDataInStructureBackgroundCmd.java
@@ -98,7 +98,7 @@ public class CreateDataInStructureBackgroundCmd extends BackgroundCommand {
 
 		DataType existingDT = startData.getDataType();
 		int startIndex = startData.getComponentIndex();
-		Data lastComp = parent.getComponentAt(
+		Data lastComp = parent.getComponentContaining(
 			(int) (startData.getMinAddress().subtract(parent.getMinAddress()) + length - 1));
 		int endIndex = lastComp.getComponentIndex();
 
diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/plugin/core/analysis/ObjectiveC1_MessageAnalyzer.java b/Ghidra/Features/Base/src/main/java/ghidra/app/plugin/core/analysis/ObjectiveC1_MessageAnalyzer.java
index 9b0737a4a..26de6b959 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/plugin/core/analysis/ObjectiveC1_MessageAnalyzer.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/plugin/core/analysis/ObjectiveC1_MessageAnalyzer.java
@@ -272,7 +272,7 @@ public class ObjectiveC1_MessageAnalyzer extends AbstractAnalyzer {
 			if (data == null) {
 				return null;
 			}
-			data = data.getComponentAt((int) address.subtract(data.getAddress()));
+			data = data.getComponentContaining((int) address.subtract(data.getAddress()));
 			if (data == null) {
 				return null;
 			}
diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/pe/ResourceDataDirectory.java b/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/pe/ResourceDataDirectory.java
index e9cc3c169..b6aa8db00 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/pe/ResourceDataDirectory.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/pe/ResourceDataDirectory.java
@@ -680,7 +680,7 @@ public class ResourceDataDirectory extends DataDirectory {
 					}
 
 					String menuString = fixupStringRepForDisplay(
-						data.getComponentAt(offset).getDefaultValueRepresentation());
+						data.getComponentContaining(offset).getDefaultValueRepresentation());
 					menuString = menuString.replaceAll("\"", "");
 					if (menuString.equals("")) {
 						comment.append("-------------------\n");
diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/listingpanel/ProgramBigListingModel.java b/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/listingpanel/ProgramBigListingModel.java
index 46e7d8be4..edefd53de 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/listingpanel/ProgramBigListingModel.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/listingpanel/ProgramBigListingModel.java
@@ -263,7 +263,7 @@ public class ProgramBigListingModel implements ListingModel, FormatModelListener
 		}
 		else if (dt instanceof Structure) {
 			int offset = (int) address.subtract(parent.getMinAddress());
-			data = parent.getComponentAt(offset);
+			data = parent.getComponentContaining(offset);
 
 			// Need to handle filler in a special way.
 			if (data == null) {
@@ -281,7 +281,7 @@ public class ProgramBigListingModel implements ListingModel, FormatModelListener
 		}
 		else {
 			int offset = (int) address.subtract(parent.getMinAddress());
-			data = parent.getComponentAt(offset);
+			data = parent.getComponentContaining(offset);
 		}
 		if (data == null) {
 			return null;
diff --git a/Ghidra/Features/Base/src/test.slow/java/ghidra/app/plugin/core/codebrowser/ExpandCollapseDataActionsTest.java b/Ghidra/Features/Base/src/test.slow/java/ghidra/app/plugin/core/codebrowser/ExpandCollapseDataActionsTest.java
index 30c892aad..92827c1fe 100644
--- a/Ghidra/Features/Base/src/test.slow/java/ghidra/app/plugin/core/codebrowser/ExpandCollapseDataActionsTest.java
+++ b/Ghidra/Features/Base/src/test.slow/java/ghidra/app/plugin/core/codebrowser/ExpandCollapseDataActionsTest.java
@@ -365,7 +365,7 @@ public class ExpandCollapseDataActionsTest extends AbstractGhidraHeadedIntegrati
 	private Data getData(Address addr) {
 		Data data = program.getListing().getDataContaining(addr);
 		if (!data.getAddress().equals(addr)) {
-			data = data.getComponentAt((int) addr.subtract(data.getAddress()));
+			data = data.getComponentContaining((int) addr.subtract(data.getAddress()));
 		}
 		return data;
 	}
-- 
2.41.0

