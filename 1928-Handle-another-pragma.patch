From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Learath <learath2@gmail.com>
Date: Tue, 2 Jun 2020 21:40:29 +0300
Subject: [PATCH] 1928: Handle another pragma

Handle #pragma align=.*
---
 .../Base/src/main/javacc/ghidra/app/util/cparser/C/C.jj  | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/Ghidra/Features/Base/src/main/javacc/ghidra/app/util/cparser/C/C.jj b/Ghidra/Features/Base/src/main/javacc/ghidra/app/util/cparser/C/C.jj
index 83d9c4735..aadc064e7 100644
--- a/Ghidra/Features/Base/src/main/javacc/ghidra/app/util/cparser/C/C.jj
+++ b/Ghidra/Features/Base/src/main/javacc/ghidra/app/util/cparser/C/C.jj
@@ -1366,6 +1366,8 @@ TOKEN :
     |
     <PCOMMA : ",">
     |
+    <PEQUALS : "=">
+    |
     <PINTEGER_LITERAL : 
         <PDECIMAL_LITERAL> (  "ull" | "ULL" | "ul" | "UL" | "ll" | "LL" | "l" | "L" | "U" | "u")?
         |
@@ -1910,7 +1912,7 @@ Token MultiLineString() : {
 void PragmaSpec() : {
 }
 {
-  ( ( <PRAGMA> ) PragmaSpecifier() )
+  ( ( <PRAGMA> ) (PragmaSpecifier())+ )
 }
 
  
@@ -1922,8 +1924,9 @@ void PragmaSpecifier() : {
 {
   LOOKAHEAD(3)
   <POPEN> PragmaSpecifier() <PCLOSE> |
-      id=<PIDENTIFIER> (<PIDENTIFIER> | <PINTEGER_LITERAL> | <PSTRING_LITERAL>)*
-          ([ <POPEN> [ (ds1=PragmaConstant())+ [ ( <PCOMMA> ds2=PragmaConstant() ) [ ( <PCOMMA> ds3=PragmaConstant() ) [ ( <PCOMMA> PragmaConstant() )+ ] ] ] ] <PCLOSE> ] ) 
+  id=<PIDENTIFIER>
+    ( [ <POPEN> [ ds1=PragmaConstant() [ ( <PCOMMA> ds2=PragmaConstant() ) [ ( <PCOMMA> ds3=PragmaConstant() ) [ ( <PCOMMA> PragmaConstant() )+ ] ] ] ] <PCLOSE> ] |
+    [ <PEQUALS> ( <PIDENTIFIER> | <PSTRING_LITERAL> | <PINTEGER_LITERAL>) ] )
   {
     if (id.image.equals("pack") && ds1 != null) {
         Token newPackVal = ds1;
-- 
2.40.0

