From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Simon Frankau <sgf@arbitrary.name>
Date: Fri, 5 May 2023 15:20:11 +0100
Subject: [PATCH] 5298: Adjust plate comment word-wrap to take account of the
 plate wrapping space.

---
 .../ghidra/app/util/viewer/field/PlateFieldFactory.java     | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/field/PlateFieldFactory.java b/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/field/PlateFieldFactory.java
index 7eae77c9b..b44ae2a37 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/field/PlateFieldFactory.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/util/viewer/field/PlateFieldFactory.java
@@ -246,7 +246,11 @@ public class PlateFieldFactory extends FieldFactory {
 			commentsList.add(CommentUtils.parseTextForAnnotations(c, p, prototype, row++));
 		}
 		if (isWordWrap) {
-			commentsList = FieldUtils.wordWrapList(new CompositeFieldElement(commentsList), width);
+			int charWidth = getMetrics().charWidth(' ');
+			int paddingWidth = CONTENT_PADDING * charWidth;
+			commentsList = FieldUtils.wordWrapList(
+				new CompositeFieldElement(commentsList),
+				Math.max(width - paddingWidth, charWidth));
 		}
 		boolean isClipped = addSideBorders(commentsList);
 		elements.addAll(commentsList);
-- 
2.40.0

